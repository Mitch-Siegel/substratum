#include "tests-common.sb"

struct eights
{
    public u8 a;
    public u8 b;
    public u8 c;
    public u8 d;
};

struct sixteens
{
    public u8 a;
    public u16 b;
    public u8 c;
};

fun testBasicCasting()
{
    u64 largeValue = 0x1234567890abcdef;
    printHex(largeValue as u64, 1);
    printHex(largeValue as u32, 1);
    printHex(largeValue as u16, 1);
    printHex(largeValue as u8, 1);
}

fun testBasicCasting2()
{
    u64 junk = 0xffffffffffffffff;
    u8 smallValue  = 0xee;
    u64 junk2 = 0xffffffffffffffff;
    printHex(smallValue as u64, 1);
    printHex(smallValue as u32, 1);
    printHex(smallValue as u16, 1);
    printHex(smallValue as u8, 1);
}

fun testCastStoring()
{
    u64 largerValue = 0xFFFFFFFFFFFFFFFF;
    printHex(largerValue, 1);

    largerValue = largerValue as u32;
    printHex(largerValue, 1);

    largerValue = largerValue as u16;
    printHex(largerValue, 1);

    largerValue += 2;
    printHex(largerValue, 1);

    largerValue = largerValue as u8;
    printHex(largerValue, 1);
}

fun testStructPointerCasting()
{
    eights e;

    sixteens *sp = (&e) as sixteens *;
    e.a = 0x12;
    e.b = 0x34;
    e.c = 0x56;
    e.d = 0x78;

    printHex(e.a, 1);
    printHex(e.b, 1);
    printHex(e.c, 1);
    printHex(e.d, 1);

    printHex(sp.a, 1);
    printHex(sp.b, 1);

    sp.b = 0xffff;
    printHex(e.a, 1);
    printHex(e.b, 1);
    printHex(e.c, 1);
    printHex(e.d, 1);
}


fun main()
{
    testBasicCasting();
    putc('\n');
    testBasicCasting2();
    putc('\n');
    testCastStoring();
    putc('\n');
    testStructPointerCasting();
    exit();
}
